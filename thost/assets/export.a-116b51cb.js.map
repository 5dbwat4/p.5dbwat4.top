{"version":3,"file":"export.a-116b51cb.js","sources":["../../src/views/grouping/export.a.vue"],"sourcesContent":["<template>\r\n  <!-- <n-checkbox\r\n    class=\"noprint\"\r\n    v-model:checked=\"displayADirectly\"\r\n    @update:checked=\"handledisplayADirectlyCheckedChange\"\r\n  >\r\n    直接从组卷网获取答案解析数据而非从oss缓存\r\n  </n-checkbox> -->\r\n  <n-button @click=\"HEI__0+=20\" class=\"noprint\">Height+</n-button>\r\n  <n-button @click=\"HEI__0-=10\" class=\"noprint\">Height-</n-button>\r\n  <n-input-number class=\"noprint\" v-model:value=\"HEI__0\" style=\"width:90px\"></n-input-number>\r\n  <n-button @click=\"OCRAll(8)\" class=\"noprint\">OCR all chars</n-button>\r\n  <n-button @click=\"OCRAll(3)\" class=\"noprint\">OCR all blocks</n-button>\r\n  <n-button @click=\"OCRAllSelective()\" class=\"noprint\"\r\n    >OCR all selective</n-button\r\n  >\r\n  <n-button @click=\"showHeapHeight\"  class=\"noprint\">显示顶端高度: {{ HeapHeight }} px</n-button>\r\n  <!-- <n-p class=\"noprint\">Current Heap Height:{{  }}</n-p> -->\r\n  <div :style=\"{ width: '18.76cm', 'line-height': 'normal' }\" id=\"oonom\" v-if=\"loaded\">\r\n    <div class=\"noprint\">\r\n      <!-- <div class=\"labi-container\">\r\n                <div class=\"labi-block\" v-for=\"rr in [1,2,3,4,5,6,7]\" :key=\"rr\" \r\n        :style=\"{height:1045+'px'}\">Page # {{rr}}</div>\r\n        </div> -->\r\n    </div>\r\n    <div :style=\"{display:'block',height:HEI__0+'px'}\"></div>\r\n    <!-- <n-image-group> -->\r\n      <div\r\n        id=\"corehtml\"\r\n        :style=\"{ width: '18.76cm', columns: 2, 'line-height': 'normal' }\"\r\n      >\r\n        <p\r\n          style=\"font-size: 9.5pt; font-family: Cambria, fangsong; margin: 0px\"\r\n        >\r\n          Generated by thost | Group UUID: {{ $route.params.id }} | Title:\r\n          {{ grouptitle }}\r\n        </p>\r\n        <div v-for=\"oo,i in chunk2array(Tlist)\" :key=\"oo.id\" :style=\"{display: OCRResAccepted[oo.id]?\r\n        'inline-block':'block'}\">\r\n          <div v-if=\"!OCRResAccepted[oo.id]\">\r\n          <p style=\"font-size: 9.5pt; margin: 0px; font-family: Cambria, 仿宋\">\r\n            UUID:<span style=\"font-family: 'courier new'\">{{ oo.id }}</span> |\r\n            qid:<span style=\"font-family: 'courier new'\">{{ oo.qid }}</span>\r\n          </p>\r\n        </div>\r\n\r\n          <div style=\"overflow: hidden;display: inline-block;\">\r\n            <img\r\n              :src=\"(XKWGetFile[oo.id] || { a: '' }).a\"\r\n              v-if=\"!OCRResAccepted[oo.id]\"\r\n            />\r\n            <n-button @click=\"OCRSingle(oo, 8)\" class=\"noprint\"\r\n              >OCR chars</n-button\r\n            >\r\n            <n-button @click=\"OCRSingle(oo, 3)\" class=\"noprint\"\r\n              >OCR block</n-button\r\n            >\r\n            <p v-if=\"orcres[oo.id]&&!OCRResAccepted[oo.id]\" style=\"margin: 0 0\">{{ orcres[oo.id] }}</p>\r\n            <n-button @click=\"OCRResAccepted[oo.id] = true\" class=\"noprint\"\r\n              >Accept OCR Result</n-button\r\n            >\r\n            <p style=\"display: inline;margin: 5.5pt;\" v-if=\"OCRResAccepted[oo.id]\">\r\n        {{ i+1 }}.  {{ orcres[oo.id] }}\r\n      </p>\r\n            <div></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    <!-- </n-image-group> -->\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, nextTick } from \"vue\";\r\nimport { useRoute, useRouter } from \"vue-router\";\r\nconst route = useRoute(),\r\n  router = useRouter();\r\n\r\nimport { NButton, NCheckbox, NP, NSpin, NImage, NImageGroup,NInputNumber } from \"naive-ui\";\r\n\r\nimport { normalizeq } from \"../../shared/normalize_q/toPrint\";\r\nimport { qtypes } from \"../../shared/define_basic_qtypes\";\r\nimport { API } from \"../../shared/APIHelper\";\r\nimport swal from \"sweetalert\";\r\n\r\nconst HEI__0=ref(0)\r\n\r\nconst loaded=ref(false)\r\n\r\nconst shown = ref({\r\n  q: true,\r\n  a: false,\r\n  p: false,\r\n});\r\n\r\nconst Noptions_ret2 = ref(false);\r\nconst grouptitle = ref(\"\");\r\n\r\nconst Tlist = ref({});\r\nlet groupentry = [];\r\nAPI.get(\"/api/group/get/\"+route.params.id).then((sss) => {\r\n  sss.entry.split(\",\").forEach((v) => {\r\n    Tlist.value[v] = qtypes;\r\n  });\r\n\r\n  groupentry = sss.entry.split(\",\");\r\n\r\n  grouptitle.value = sss.title;\r\n\r\n  Promise.all(\r\n    sss.entry.split(\",\").map(\r\n      (v) =>\r\n        new Promise((res, rej) => {\r\n          API.get(\"/api/data/get/\" + v).then((i) => {\r\n            Tlist.value[v] = i;\r\n            API.get(\"/api/xkw-helper/getCachedImg/\"+i.bankid+\"/\"+i.qid+\"/400\").then(ra=>{\r\n                      XKWGetFile.value[i.id] = {\r\n          a:\r\n            API.host +\r\n            \"/api/xkw-helper/route-pic?purl=\" +\r\n            btoa(ra.answer.replace(\"@2\", \"@3\").replace(\"c2\", \"c1\")),\r\n          p:\r\n            API.host +\r\n            \"/api/xkw-helper/route-pic?purl=\" +\r\n            btoa(ra.parse.replace(\"@2\", \"@3\").replace(\"c2\", \"c1\")),\r\n        };\r\n        console.log(XKWGetFile,i);\r\n        res()\r\n            })\r\n          });\r\n          // GetDoneInfo(v);\r\n        })\r\n    )\r\n  ).then(() => {\r\n    loaded.value=true\r\n  });\r\n  // fetch(\"/api/get\",{\"method\":\"POST\",\"body\":JSON.stringify({id:v}),\"headers\":{\"Content-Type\":\"application/json\"}}).then(o=>o.json()).then(i=>{\r\n  //     Tlist.value[v]=i\r\n  // })\r\n  // }))).then(()=>{\r\n\r\n  // })\r\n});\r\n\r\nconst _types = {};\r\n\r\n//adddddd\r\n\r\nconst _JSONparse = (v) => {\r\n  return JSON.parse(v);\r\n};\r\n\r\nconst doneinfo = ref({}),\r\n  chunk2array = (mm) => Object.entries(mm).map((o) => o[1]);\r\n\r\n// const markAsDone = async (rel) => {\r\n//   console.log(rel);\r\n//   await API.post(\"/api/qapi/doneinfo/mark\", {\r\n//     quuid: rel.id,\r\n//     timestamp: new Date().getTime(),\r\n//     displayednote: \"\",\r\n//     note: \"\",\r\n//     rate: 50,\r\n//     bankid: rel.bankid,\r\n//   });\r\n// };\r\n\r\n// const markAsDoneAll = async () => {\r\n//   Promise.all(Object.entries(Tlist.value).map((rr) => markAsDone(rr[1]))).then(\r\n//     (v) => {\r\n//       swal(\"ok.\");\r\n//     }\r\n//   );\r\n// };\r\n\r\n// const GetDoneInfo = async (id) => {\r\n//   doneinfo.value[id] = await API.get(\"/api/qapi/doneinfo/getbyquuid/\" + id);\r\n// };\r\n\r\nconst displayADirectly = ref(false),\r\n  XKWGetFile = ref({});\r\n\r\n\r\n// const handledisplayADirectlyCheckedChange = (checked) => {\r\n//   console.log(checked);\r\n//   displayADirectly.value = checked;\r\n//   if (displayADirectly.value) {\r\n//     Object.entries(Tlist.value).forEach((v1) => {\r\n//       console.log(v1);\r\n//       API.get(\r\n//         \"/api/xkw-helper/get_more_detail/400/\" + v1[1].bankid + \"/\" + v1[1].qid\r\n//       ).then((r) => {\r\n//         _types[v1[0]] = r.data.type;\r\n//         XKWGetFile.value[v1[1].id] = {\r\n//           a:\r\n//             API.host +\r\n//             \"/api/xkw-helper/route-pic?purl=\" +\r\n//             btoa(r.data.answerImg.replace(\"@2\", \"@3\").replace(\"c2\", \"c1\")),\r\n//           p:\r\n//             API.host +\r\n//             \"/api/xkw-helper/route-pic?purl=\" +\r\n//             btoa(r.data.parseImg.replace(\"@2\", \"@3\").replace(\"c2\", \"c1\")),\r\n//         };\r\n//       });\r\n//     });\r\n//   }\r\n// };\r\n\r\n\r\n\r\nconst orcres = ref({}),\r\n  OCRResAccepted = ref({});\r\nconst OCRSingle = (oo, psm) => {\r\n  API.post(\"/ocr-service\", {\r\n    url: XKWGetFile.value[oo.id].a,\r\n    psm,\r\n    lang: \"eng+chi_sim\",\r\n  }).then((v) => {\r\n    orcres.value[oo.id] = v.result;\r\n  });\r\n};\r\nconst OCRAll = (psm) => {\r\n  for (let i = 0; i < chunk2array(Tlist.value).length; i++) {\r\n    let oo = chunk2array(Tlist.value)[i];\r\n\r\n    console.log(oo);\r\n    API.post(\"/ocr-service\", {\r\n      url: XKWGetFile.value[oo.id].a,\r\n      psm,\r\n      lang: \"eng+chi_sim\",\r\n    }).then((v) => {\r\n      orcres.value[oo.id] = v.result;\r\n    });\r\n  }\r\n};\r\n\r\n\r\n\r\nconst PSM_BLOCK=3,PSM_CHARS=8\r\nconst OCRAllSelective = () => {\r\n  const asChar=[\r\n    2901,290101,2908,//11\r\n    2701,2704,\r\n    3011,3012,\r\n    3101,310101,310104,3103,\r\n    261104,\r\n  ],\r\n  asEnglishChoiceBlock=[\r\n    2801,280101,280102,280103,\r\n    2803,2804,280401,280402,280403,280404,\r\n    2805,2820,\r\n    2808,2809,280901,280902,280903,280904,\r\n    2812,281201,281203,\r\n2813,281301,281302,\r\n\r\n\r\n  ]\r\n  for (let i = 0; i < chunk2array(Tlist.value).length; i++) {\r\n    let oo = chunk2array(Tlist.value)[i];\r\n    console.log(oo.type);\r\n    if(asEnglishChoiceBlock.includes(oo.type)){\r\n        API.post(\"/ocr-service\", {\r\n      url: XKWGetFile.value[oo.id].a,\r\n      psm:PSM_BLOCK,\r\n      lang: \"eng+chi_sim\",\r\n    }).then((v) => {\r\n      orcres.value[oo.id] = v.result;\r\n      OCRResAccepted.value[oo.id] = true\r\n    });\r\n    }else     if(asChar.includes(oo.type)){\r\n        API.post(\"/ocr-service\", {\r\n      url: XKWGetFile.value[oo.id].a,\r\n      psm:PSM_CHARS,\r\n      lang: \"eng+chi_sim\",\r\n    }).then((v) => {\r\n      orcres.value[oo.id] = v.result;\r\n      OCRResAccepted.value[oo.id] = true\r\n    });\r\n    }\r\n\r\n  }\r\n};\r\n\r\nconst HeapHeight=ref(0)\r\n\r\nconst showHeapHeight=async()=>{\r\n  const scs=document.querySelectorAll(\"#oonom .noprint\")\r\n  scs.forEach(oc=>{\r\n    oc.style.display=\"none\"\r\n  })\r\n  await nextTick()\r\n  HeapHeight.value=document.querySelector(\"#oonom\").clientHeight\r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n@media print {\r\n  .noprint {\r\n    display: none;\r\n  }\r\n}\r\n\r\n.noprint {\r\n  user-select: none;\r\n}\r\n/* .labi-container{\r\n        display: block;\r\n        height: fit-content;\r\n        width: 100%;\r\n        position: absolute;\r\n        z-index: -1;\r\n    }\r\n    .labi-block{\r\n        display: block;\r\n        width: 100%;\r\n        border-bottom-color: black;\r\n        border-bottom-width: 2px;\r\n        position:relative;\r\n        border-bottom-style: dotted;\r\n        text-align:right;\r\n    } */\r\n\r\nimg {\r\n  width: 410px;\r\n  left: -60px;\r\n  position: relative;\r\n  filter: brightness(1.05);\r\n}\r\n\r\ntd {\r\n  padding: 0;\r\n}\r\n</style>\r\n"],"names":["PSM_BLOCK","PSM_CHARS","route","useRoute","useRouter","HEI__0","ref","loaded","grouptitle","Tlist","API","sss","v","qtypes","res","rej","i","ra","XKWGetFile","chunk2array","mm","o","orcres","OCRResAccepted","OCRSingle","oo","psm","OCRAll","OCRAllSelective","asChar","asEnglishChoiceBlock","HeapHeight","showHeapHeight","oc","nextTick"],"mappings":"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"}