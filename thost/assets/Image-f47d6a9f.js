import{e as P}from"./Button-d0cd9be2.js";import{i as E,a as I,b as j,c as y}from"./ImageGroup-4e23e147.js";import{u as L}from"./light-d6058c0b.js";import{v as R,aZ as v,O as k,a2 as O,aA as S,_ as x,aa as _,b3 as C,J as u}from"./runtime-core.esm-bundler-c066f4bf.js";const M=P&&"loading"in document.createElement("img"),z=(e={})=>{var n;const{root:a=null}=e;return{hash:`${e.rootMargin||"0px 0px 0px 0px"}-${Array.isArray(e.threshold)?e.threshold.join(","):(n=e.threshold)!==null&&n!==void 0?n:"0"}`,options:Object.assign(Object.assign({},e),{root:(typeof a=="string"?document.querySelector(a):a)||document.documentElement})}},m=new WeakMap,f=new WeakMap,b=new WeakMap,A=(e,n,a)=>{if(!e)return()=>{};const i=z(n),{root:o}=i.options;let l;const h=m.get(o);h?l=h:(l=new Map,m.set(o,l));let c,s;l.has(i.hash)?(s=l.get(i.hash),s[1].has(e)||(c=s[0],s[1].add(e),c.observe(e))):(c=new IntersectionObserver(d=>{d.forEach(g=>{if(g.isIntersecting){const p=f.get(g.target),w=b.get(g.target);p&&p(),w&&(w.value=!0)}})},i.options),c.observe(e),s=[c,new Set([e])],l.set(i.hash,s));let r=!1;const t=()=>{r||(f.delete(e),b.delete(e),r=!0,s[1].has(e)&&(s[0].unobserve(e),s[1].delete(e)),s[1].size<=0&&l.delete(i.hash),l.size||m.delete(o))};return f.set(e,t),b.set(e,a),t},N=Object.assign({alt:String,height:[String,Number],imgProps:Object,previewedImgProps:Object,lazy:Boolean,intersectionObserverOptions:Object,objectFit:{type:String,default:"fill"},previewSrc:String,fallbackSrc:String,width:[String,Number],src:String,previewDisabled:Boolean,loadDescription:String,onError:Function,onLoad:Function},y),B=R({name:"Image",props:N,inheritAttrs:!1,setup(e){const n=v(null),a=v(!1),i=v(null),o=k(E,null),{mergedClsPrefixRef:l}=o||L(e),h={click:()=>{if(e.previewDisabled||a.value)return;const r=e.previewSrc||e.src;if(o){o.setPreviewSrc(r),o.setThumbnailEl(n.value),o.toggleShow();return}const{value:t}=i;t&&(t.setPreviewSrc(r),t.setThumbnailEl(n.value),t.toggleShow())}},c=v(!e.lazy);O(()=>{var r;(r=n.value)===null||r===void 0||r.setAttribute("data-group-id",o?.groupId||"")}),O(()=>{if(e.lazy&&e.intersectionObserverOptions){let r;const t=S(()=>{r?.(),r=void 0,r=A(n.value,e.intersectionObserverOptions,c)});x(()=>{t(),r?.()})}}),S(()=>{var r;e.src,(r=e.imgProps)===null||r===void 0||r.src,a.value=!1});const s=v(!1);return _(I,{previewedImgPropsRef:C(e,"previewedImgProps")}),Object.assign({mergedClsPrefix:l,groupId:o?.groupId,previewInstRef:i,imageRef:n,showError:a,shouldStartLoading:c,loaded:s,mergedOnClick:r=>{var t,d;h.click(),(d=(t=e.imgProps)===null||t===void 0?void 0:t.onClick)===null||d===void 0||d.call(t,r)},mergedOnError:r=>{if(!c.value)return;a.value=!0;const{onError:t,imgProps:{onError:d}={}}=e;t?.(r),d?.(r)},mergedOnLoad:r=>{const{onLoad:t,imgProps:{onLoad:d}={}}=e;t?.(r),d?.(r),s.value=!0}},h)},render(){var e,n;const{mergedClsPrefix:a,imgProps:i={},loaded:o,$attrs:l,lazy:h}=this,c=(n=(e=this.$slots).placeholder)===null||n===void 0?void 0:n.call(e),s=this.src||i.src,r=u("img",Object.assign(Object.assign({},i),{ref:"imageRef",width:this.width||i.width,height:this.height||i.height,src:this.showError?this.fallbackSrc:h&&this.intersectionObserverOptions?this.shouldStartLoading?s:void 0:s,alt:this.alt||i.alt,"aria-label":this.alt||i.alt,onClick:this.mergedOnClick,onError:this.mergedOnError,onLoad:this.mergedOnLoad,loading:M&&h&&!this.intersectionObserverOptions?"lazy":"eager",style:[i.style||"",c&&!o?{height:"0",width:"0",visibility:"hidden"}:"",{objectFit:this.objectFit}],"data-error":this.showError,"data-preview-src":this.previewSrc||this.src}));return u("div",Object.assign({},l,{role:"none",class:[l.class,`${a}-image`,(this.previewDisabled||this.showError)&&`${a}-image--preview-disabled`]}),this.groupId?r:u(j,{theme:this.theme,themeOverrides:this.themeOverrides,clsPrefix:a,ref:"previewInstRef",showToolbar:this.showToolbar,showToolbarTooltip:this.showToolbarTooltip},{default:()=>r}),!o&&c)}});export{B as N};
