{"version":3,"file":"index-aae5f00a.js","sources":["../../src/views/grouping/index.vue"],"sourcesContent":["<template>\r\n<n-button class=\"noprint\" @click=\"shown.q=!shown.q\">Q</n-button>\r\n<n-button class=\"noprint\" @click=\"shown.a=!shown.a\">A</n-button>\r\n<n-button class=\"noprint\" @click=\"shown.p=!shown.p\">P</n-button>\r\n<n-button @click=\"router.push('/grouping/preexport-1/'+route.params.id)\">开始准备打印</n-button>\r\n<n-button @click=\"router.push('/export/'+route.params.id+'/a')\">打印答案</n-button>\r\n<n-button @click=\"markAsDoneAll\">将本group内所有试题标记为done</n-button>\r\n    <n-checkbox v-model:checked=\"displayADirectly\" @update:checked=\"handledisplayADirectlyCheckedChange\">\r\n      直接从组卷网获取答案解析数据而非从oss缓存\r\n    </n-checkbox>\r\n<div :style=\"{width:'18.76cm','line-height':'normal'}\" id=\"oonom\">\r\n    <div class=\"noprint\">\r\n        <!-- <div class=\"labi-container\">\r\n            <div class=\"labi-block\" v-for=\"rr in [1,2,3,4,5,6,7]\" :key=\"rr\" \r\n    :style=\"{height:1045+'px'}\">Page # {{rr}}</div>\r\n    </div> -->\r\n    </div>      <n-image-group> \r\n    <div id=\"corehtml\" :style=\"{width:'18.76cm',columns:1,'line-height':'normal'}\">\r\n    <p style=\"font-size:9.5pt;font-family:Cambria , fangsong;margin:0px\">Generated by thost | Group UUID: {{$route.params.id}} | Title: {{grouptitle}}</p>\r\n<div v-for=\"oo in chunk2array(Tlist)\" :key=\"oo.id\">\r\n    <p style=\"font-size:9.5pt;margin:0px;font-family:Cambria , 仿宋;\">UUID:<span style=\"font-family:'courier new'\">{{oo.id}}</span> | qid:<span style=\"font-family:'courier new'\">{{oo.qid}}</span> <span v-if=\"shown.q\">| Info: {{_JSONparse(oo.extra).info}} | Origin: {{_JSONparse(oo.extra).from}}</span></p>\r\n<div v-if=\"shown.q\" v-html=\"normalizeq(oo.q,{ret2:Noptions_ret2})\" :style=\"{fontSize:'12pt',fontFamily:'Cambria'}\" ></div>\r\n<div v-if=\"shown.q\" :style=\"{display:'block',height:(oo._extb_height||0)+'px'}\"></div>\r\n<div v-if=\"shown.a&&!displayADirectly\"><img :src='API.host+\"/oss-storage/\"+oo.a.replace(\"<answerparser>\",\"\").replace(\"</answerparser>\",\"\").split(\"|\")[0]+\".png\"'/></div>\r\n<div v-if=\"shown.p&&!displayADirectly\"><img :src='API.host+\"/oss-storage/\"+oo.a.replace(\"<answerparser>\",\"\").replace(\"</answerparser>\",\"\").split(\"|\")[1]+\".png\"'/></div>\r\n<div v-if=\"displayADirectly\">\r\n\r\n         <n-image  lazy :src=\"(XKWGetFile[oo.id]||{a:''}).a\"><template #placeholder><n-spin/></template></n-image>\r\n         <n-image  lazy :src=\"(XKWGetFile[oo.id]||{p:''}).p\"><template #placeholder><n-spin/></template></n-image>\r\n\r\n        <div>\r\n    </div></div>\r\n<n-button text @click=\"markAsDone(oo)\">标记为已完成</n-button>\r\n<n-p>完成状态：{{doneinfo[oo.id]}}</n-p>\r\n</div>\r\n</div>          </n-image-group></div>\r\n\r\n</template>\r\n\r\n<script setup>\r\n\r\nimport { onMounted, ref } from \"vue\"\r\nimport {useRoute,useRouter} from \"vue-router\"\r\nconst route=useRoute(),router=useRouter()\r\n\r\nimport {NButton,NCheckbox,NP,NSpin,NImage,NImageGroup} from \"naive-ui\"\r\n\r\nimport {normalizeq} from \"../../shared/nomorlize_q\"\r\nimport {qtypes} from \"../../shared/define_basic_qtypes\"\r\nimport { API } from \"../../shared/APIHelper\"\r\nimport swal from \"sweetalert\"\r\nconst shown=ref({\r\n    q:true,\r\n    a:false,\r\n    p:false\r\n})\r\n\r\nconst Noptions_ret2=ref(false)\r\nconst grouptitle=ref(\"\")\r\n\r\nconst Tlist=ref({})\r\nlet groupentry=[]\r\nAPI.post(\"/api/group/get\",{id:route.params.id}).then(sss=>{\r\n\r\nsss.entry.split(\",\").forEach(v => {\r\n    Tlist.value[v]=qtypes\r\n});\r\n\r\ngroupentry=sss.entry.split(\",\")\r\n\r\n\r\n\r\ngrouptitle.value=sss.title\r\n\r\nPromise.all(sss.entry.split(\",\").map(v=>new Promise((res,rej)=>{\r\nAPI.get(\"/api/qapi/get/\"+v).then(i=>{\r\n    Tlist.value[v]=i\r\n})\r\nGetDoneInfo(v)\r\n}))).then(()=>{\r\n\r\n})\r\n// fetch(\"/api/get\",{\"method\":\"POST\",\"body\":JSON.stringify({id:v}),\"headers\":{\"Content-Type\":\"application/json\"}}).then(o=>o.json()).then(i=>{\r\n//     Tlist.value[v]=i\r\n// })\r\n// }))).then(()=>{\r\n\r\n// })\r\n\r\n\r\n\r\n})\r\n\r\n\r\n\r\n\r\n//adddddd\r\n\r\n\r\nconst _JSONparse=(v)=>{return JSON.parse(v)}\r\n\r\nconst doneinfo=ref({})\r\n\r\n,chunk2array=mm=>Object.entries(mm).map(o=>o[1])\r\n\r\n\r\nconst markAsDone=async(rel)=>{\r\n    console.log(rel);\r\n    await API.post(\"/api/qapi/doneinfo/mark\",{\r\nquuid:rel.id,\r\ntimestamp:(new Date()).getTime(),\r\ndisplayednote:\"\",\r\nnote :\"\",\r\nrate:50,\r\nbankid:rel.bankid\r\n\r\n    })\r\n}\r\n\r\nconst markAsDoneAll=async()=>{\r\n        Promise.all(Object.entries(Tlist.value).map(rr=>markAsDone(rr[1]))).then(v=>{\r\n            swal(\"ok.\")\r\n        })\r\n}\r\n\r\nconst GetDoneInfo=async(id)=>{\r\n    doneinfo.value[id]= await API.get(\"/api/qapi/doneinfo/getbyquuid/\"+id)\r\n}\r\n\r\n\r\nconst displayADirectly=ref(false),XKWGetFile=ref({})\r\nconst handledisplayADirectlyCheckedChange=(checked)=>{\r\n    console.log(checked);\r\ndisplayADirectly.value=checked\r\nif(displayADirectly.value){\r\n    Object.entries(Tlist.value).forEach(v1 => {\r\n        console.log(v1);\r\n            API.get(\"/api/xkw-helper/get_more_detail/600/\"+v1[1].bankid+\"/\"+v1[1].qid).then(r=>{\r\n                \r\n        XKWGetFile.value[v1[1].id]={\r\n            a:API.host+\"/api/xkw-helper/route-pic?purl=\"+btoa(r.data.answerImg.replace(\"@2\",\"@3\").replace(\"c2\",\"c1\")),\r\n            p:API.host+\"/api/xkw-helper/route-pic?purl=\"+btoa(r.data.parseImg.replace(\"@2\",\"@3\").replace(\"c2\",\"c1\")),\r\n        }\r\n})\r\n    });\r\n}\r\n}\r\n</script>\r\n\r\n<style>\r\n@media print{\r\n    .noprint{\r\n        display: none;\r\n    }\r\n\r\n}\r\n\r\n/* .labi-container{\r\n    display: block;\r\n    height: fit-content;\r\n    width: 100%;\r\n    position: absolute;\r\n    z-index: -1;\r\n}\r\n.labi-block{\r\n    display: block;\r\n    width: 100%;\r\n    border-bottom-color: black;\r\n    border-bottom-width: 2px;\r\n    position:relative;\r\n    border-bottom-style: dotted;\r\n    text-align:right;\r\n} */\r\n\r\nimg{\r\n    max-width: 350px;\r\n}\r\n\r\ntd{\r\n    padding:0\r\n}\r\n</style>\r\n"],"names":["route","useRoute","router","useRouter","shown","ref","Noptions_ret2","grouptitle","Tlist","API","sss","v","qtypes","res","rej","i","GetDoneInfo","_JSONparse","doneinfo","chunk2array","mm","o","markAsDone","rel","markAsDoneAll","rr","swal","id","displayADirectly","XKWGetFile","handledisplayADirectlyCheckedChange","checked","v1","r"],"mappings":"s5DA2CA,MAAMA,EAAMC,EAAQ,EAAGC,EAAOC,EAAW,EAQnCC,EAAMC,EAAI,CACZ,EAAE,GACF,EAAE,GACF,EAAE,EACN,CAAC,EAEKC,EAAcD,EAAI,EAAK,EACvBE,EAAWF,EAAI,EAAE,EAEjBG,EAAMH,EAAI,EAAE,EAElBI,EAAI,KAAK,iBAAiB,CAAC,GAAGT,EAAM,OAAO,EAAE,CAAC,EAAE,KAAKU,GAAK,CAE1DA,EAAI,MAAM,MAAM,GAAG,EAAE,QAAQC,GAAK,CAC9BH,EAAM,MAAMG,CAAC,EAAEC,CACnB,CAAC,EAEUF,EAAI,MAAM,MAAM,GAAG,EAI9BH,EAAW,MAAMG,EAAI,MAErB,QAAQ,IAAIA,EAAI,MAAM,MAAM,GAAG,EAAE,IAAIC,GAAG,IAAI,QAAQ,CAACE,EAAIC,IAAM,CAC/DL,EAAI,IAAI,iBAAiBE,CAAC,EAAE,KAAKI,GAAG,CAChCP,EAAM,MAAMG,CAAC,EAAEI,CACnB,CAAC,EACDC,EAAYL,CAAC,CACb,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,CAEd,CAAC,CAUD,CAAC,EAQD,MAAMM,EAAYN,GAAY,KAAK,MAAMA,CAAC,EAEpCO,EAASb,EAAI,EAAE,EAEpBc,EAAYC,GAAI,OAAO,QAAQA,CAAE,EAAE,IAAIC,GAAGA,EAAE,CAAC,CAAC,EAGzCC,EAAW,MAAMC,GAAM,CACzB,QAAQ,IAAIA,CAAG,EACf,MAAMd,EAAI,KAAK,0BAA0B,CAC7C,MAAMc,EAAI,GACV,UAAW,IAAI,KAAM,EAAE,QAAS,EAChC,cAAc,GACd,KAAM,GACN,KAAK,GACL,OAAOA,EAAI,MAEX,CAAK,CACL,EAEMC,EAAc,SAAS,CACrB,QAAQ,IAAI,OAAO,QAAQhB,EAAM,KAAK,EAAE,IAAIiB,GAAIH,EAAWG,EAAG,CAAC,CAAC,CAAC,CAAC,EAAE,KAAKd,GAAG,CACxEe,EAAK,KAAK,CACtB,CAAS,CACT,EAEMV,EAAY,MAAMW,GAAK,CACzBT,EAAS,MAAMS,CAAE,EAAG,MAAMlB,EAAI,IAAI,iCAAiCkB,CAAE,CACzE,EAGMC,EAAiBvB,EAAI,EAAK,EAAEwB,EAAWxB,EAAI,CAAA,CAAE,EAC7CyB,EAAqCC,GAAU,CACjD,QAAQ,IAAIA,CAAO,EACvBH,EAAiB,MAAMG,EACpBH,EAAiB,OAChB,OAAO,QAAQpB,EAAM,KAAK,EAAE,QAAQwB,GAAM,CACtC,QAAQ,IAAIA,CAAE,EACVvB,EAAI,IAAI,uCAAuCuB,EAAG,CAAC,EAAE,OAAO,IAAIA,EAAG,CAAC,EAAE,GAAG,EAAE,KAAKC,GAAG,CAEvFJ,EAAW,MAAMG,EAAG,CAAC,EAAE,EAAE,EAAE,CACvB,EAAEvB,EAAI,KAAK,kCAAkC,KAAKwB,EAAE,KAAK,UAAU,QAAQ,KAAK,IAAI,EAAE,QAAQ,KAAK,IAAI,CAAC,EACxG,EAAExB,EAAI,KAAK,kCAAkC,KAAKwB,EAAE,KAAK,SAAS,QAAQ,KAAK,IAAI,EAAE,QAAQ,KAAK,IAAI,CAAC,CAC1G,CACT,CAAC,CACD,CAAK,CAEL"}