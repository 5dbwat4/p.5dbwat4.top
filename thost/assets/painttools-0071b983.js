class y{constructor(s){this.dom=s,this.paintlines=[],this.painting=!1,this.context=s.getContext("2d")}onmousedown(s){console.log(window.PaintCONFIG.color),this.paintlines.push(new d({color:window.PaintCONFIG.color||"black"})),this.painting=!0,this.paintlines[this.paintlines.length-1].touchDown(s.layerX,s.layerY),this.paintlines[this.paintlines.length-1].touchMove(s.layerX+1,s.layerY+1),this.refreshCanvas()}onmouseup(s){this.painting=!1,this.paintlines[this.paintlines.length-1].touchUp(s.layerX,s.layerY)}onpointermove(s){this.painting&&(this.paintlines[this.paintlines.length-1].touchMove(s.layerX,s.layerY),this.refreshCanvas())}refreshCanvas(s){this.paintlines.forEach(a=>{a.drawSelf(this.context)})}clear(){this.paintlines=[],this.refreshCanvas()}export(){var s=this.dom.toDataURL();console.log(s)}}class d{constructor(s){this.path=new Path2D,this.paint={color:s.color||"black",lineWidth:1,operation:"source-over",alpha:1,mode:0},this.step=-1;var a=[],r=null,l,u;this.isEffective=function(){return a.length>0&&this.step>=0},this.getCacheData=function(){if(a.length<=0||!this.isEffective())return null;var t=[];for(var i in a){if(i>this.step)break;var h=a[i],n=null;for(var o in h)n==null&&(n=[]),n.push(h[o].x+","+h[o].y);n!=null&&t.push(n)}return t.length>0?{points:t,color:this.paint.color.replace("#",""),line_width:this.paint.lineWidth,alpha:this.paint.alpha,mode:this.paint.mode}:null},this.setCacheData=function(t){try{this.paint.config(t);var i=t.points;for(var h in i){var n=i[h];for(var o in n){var c=n[o],p=c.split(","),e=parseFloat(p[0]),f=parseFloat(p[1]);o==0?this.touchDown(e,f):this.touchMove(e,f)}this.touchUp()}}catch{}},this.touchDown=function(t,i){return l=t,u=i,this.path.moveTo(t*3,i*3),r=[],r.push({x:t,y:i}),!0},this.touchMove=function(t,i){return r!=null&&(Math.abs(t-l)>=1||Math.abs(i-u)>=1)?(this.path.quadraticCurveTo(l*3,u*3,(t+l)/2*3,(i+u)/2*3),l=t,u=i,!0):!1},this.touchUp=function(){return r&&r.length>0?(this.step<a.length-1&&a.splice(this.step+1),a.push(r),this.step=a.length-1,r=null,!0):(r=null,!1)},this.mementoStep=function(t){var i=this.step+t;if(i>=-1&&i<a.length){this.path=new Path2D,this.step=i;for(var h=0;h<=i;h++){var n=0,o=0,c=a[h];for(var p in c){var e=c[p];p==0?(n=e.x,o=e.y,this.path.moveTo(e.x*density,e.y*density)):(Math.abs(e.x-n)>=4||Math.abs(e.y-o)>=4)&&(this.path.quadraticCurveTo(n*density,o*density,(e.x+n)/2*density,(e.y+o)/2*density),n=e.x,o=e.y)}}return!0}return!1},this.drawSelf=function(t){t.globalCompositeOperation=this.paint.operation,t.strokeStyle=this.paint.color,t.globalAlpha=this.paint.alpha,t.lineWidth=this.paint.lineWidth*3,t.lineCap="round",t.stroke(this.path)}}}export{y as P};
