class d{constructor(i){this.dom=i,this.paintlines=[],this.painting=!1,this.context=i.getContext("2d")}onmousedown(i){console.log(window.PaintCONFIG.color),this.paintlines.push(new y({color:window.PaintCONFIG.color||"black"})),this.painting=!0,this.paintlines[this.paintlines.length-1].touchDown(i.layerX,i.layerY),this.paintlines[this.paintlines.length-1].touchMove(i.layerX+1,i.layerY+1),this.refreshCanvas()}onmouseup(i){this.painting=!1,this.paintlines[this.paintlines.length-1].touchUp(i.layerX,i.layerY)}onpointermove(i){this.painting&&(this.paintlines[this.paintlines.length-1].touchMove(i.layerX,i.layerY),this.refreshCanvas())}refreshCanvas(i){this.paintlines.forEach(h=>{h.drawSelf(this.context)})}clear(){this.paintlines=[],this.refreshCanvas()}export(){var i=this.dom.toDataURL();console.log(i)}}class y{constructor(i){this.path=new Path2D,this.paint={color:i.color||"black",lineWidth:1,operation:"source-over",alpha:1,mode:0},this.step=-1;var h=[],r=null,l,p;this.isEffective=function(){return h.length>0&&this.step>=0},this.getCacheData=function(){if(h.length<=0||!this.isEffective())return null;var t=[];for(var n in h){if(n>this.step)break;var o=h[n],s=null;for(var e in o)s==null&&(s=[]),s.push(o[e].x+","+o[e].y);s!=null&&t.push(s)}return t.length>0?{points:t,color:this.paint.color.replace("#",""),line_width:this.paint.lineWidth,alpha:this.paint.alpha,mode:this.paint.mode}:null},this.setCacheData=function(t){try{this.paint.config(t);var n=t.points;for(var o in n){var s=n[o];for(var e in s){var c=s[e],u=c.split(","),a=parseFloat(u[0]),v=parseFloat(u[1]);e==0?this.touchDown(a,v):this.touchMove(a,v)}this.touchUp()}}catch{}},this.touchDown=function(t,n){return l=t,p=n,this.path.moveTo(t*3,n*3),r=[],r.push({x:t,y:n}),!0},this.touchMove=function(t,n){return r!=null&&(Math.abs(t-l)>=1||Math.abs(n-p)>=1)?(this.path.quadraticCurveTo(l*3,p*3,(t+l)/2*3,(n+p)/2*3),l=t,p=n,!0):!1},this.touchUp=function(){return r&&r.length>0?(this.step<h.length-1&&h.splice(this.step+1),h.push(r),this.step=h.length-1,r=null,!0):(r=null,!1)},this.mementoStep=function(t){var n=this.step+t;if(n>=-1&&n<h.length){this.path=new Path2D,this.step=n;for(var o=0;o<=n;o++){var s=0,e=0,c=h[o];for(var u in c){var a=c[u];u==0?(s=a.x,e=a.y,this.path.moveTo(a.x*density,a.y*density)):(Math.abs(a.x-s)>=4||Math.abs(a.y-e)>=4)&&(this.path.quadraticCurveTo(s*density,e*density,(a.x+s)/2*density,(a.y+e)/2*density),s=a.x,e=a.y)}}return!0}return!1},this.drawSelf=function(t){t.globalCompositeOperation=this.paint.operation,t.strokeStyle=this.paint.color,t.globalAlpha=this.paint.alpha,t.lineWidth=this.paint.lineWidth*3,t.lineCap="round",t.stroke(this.path)}}}export{d as P};
