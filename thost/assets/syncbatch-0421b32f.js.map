{"version":3,"file":"syncbatch-0421b32f.js","sources":["../../src/views/batch/syncbatch.vue"],"sourcesContent":["<template>\r\n    <n-button @click=\"$router.push('/batching/from-basket')\">从试题篮</n-button>\r\n\r\n  <n-config-provider :hljs=\"hljs\">\r\n<div v-if=\"syncbatchstartedStatusOnNetworking==0\"><span>正在查询Syncbatch状态</span></div>\r\n\r\n<div v-if=\"syncbatchstartedStatusOnNetworking==1&&!syncbatchInfo.started\"><span>尚未开始Syncbatch</span>\r\n<n-input v-model:value=\"SessionTitle\"/>\r\n<n-button @click=\"StartSyncbatch\">现在开始</n-button></div>\r\n<div v-if=\"syncbatchInfo.started\">\r\n    <span>已经开始Syncbatch</span><span v-if=\"syncbatchstartedStatusOnNetworking==2\">正在发送API请求</span>\r\n    <n-spin :show=\"syncbatchstartedStatusOnNetworking==2\">\r\n<n-code :code=\"_JSONStringify(syncbatchInfo)\"></n-code>\r\n    </n-spin>\r\n<n-input v-model:value=\"SessionTitle\"/>\r\n<n-button @click=\"editTitle\">修改Title</n-button>\r\n    <n-button @click=\"saveGroup\">保存为Group</n-button>\r\n    <n-button @click=\"killSession\">终止</n-button>\r\n    <n-button v-if=\"groupsaved\" @click=\"$router.push('/group/'+groupid)\">View</n-button>\r\n</div>\r\n\r\n      </n-config-provider>\r\n<div>\r\n\r\n</div>\r\n</template>\r\n\r\n<script setup>\r\nimport { NInput ,NButton,NProgress,NCode,NConfigProvider,NSpin} from \"naive-ui\";\r\nimport { onUnmounted, ref } from \"vue\";\r\n import hljs from 'highlight.js/lib/core'\r\n  import json from 'highlight.js/lib/languages/json'\r\nimport { keep } from \"naive-ui/lib/_utils\";\r\nimport { onBeforeRouteLeave } from \"vue-router\";\r\nimport { API } from \"../../shared/APIHelper\";\r\n\r\n  hljs.registerLanguage('json', json)\r\n\r\n\r\n\r\nconst syncbatchstartedStatusOnNetworking=ref(0),syncbatchInfo=ref({\r\n  started:false,\r\n  currentids:[],\r\n  title:\"\"\r\n}),SessionTitle=ref(\"\")\r\n\r\nAPI.get(\"/api/syncbatch/sync-session\").then(v=>{\r\n    syncbatchInfo.value=v.data\r\n    syncbatchstartedStatusOnNetworking.value=1\r\n\r\n    if(syncbatchInfo.value.started){\r\n        SessionTitle.value=syncbatchInfo.value.title\r\n        sync()\r\n    }\r\n})\r\nconst StartSyncbatch=()=>{\r\n    syncbatchstartedStatusOnNetworking.value=2\r\n    API.post(\"/api/syncbatch/start-session\",{title:SessionTitle.value,time:(new Date()).getTime()}).then(v=>{\r\n        syncbatchInfo.value=v.data\r\n        syncbatchstartedStatusOnNetworking.value=1\r\n        sync()\r\n    })\r\n}\r\n\r\nlet keepSyncing=true\r\n\r\nonBeforeRouteLeave(()=>{\r\n    keepSyncing=false\r\n})\r\n\r\nconst sync=()=>{\r\n    syncbatchstartedStatusOnNetworking.value=2\r\n    API.get(\"/api/syncbatch/sync-session\").then(v=>{\r\n        syncbatchInfo.value=v.data\r\n        syncbatchstartedStatusOnNetworking.value=1\r\n        if(keepSyncing){\r\n            setTimeout(sync,1500)\r\n        }\r\n    })\r\n}\r\n\r\nconst editTitle=()=>{\r\n    syncbatchstartedStatusOnNetworking.value=2\r\n    API.post(\"/api/syncbatch/edit-title\",{title:SessionTitle.value}).then(v=>{\r\n        syncbatchInfo.value=v.data\r\n        syncbatchstartedStatusOnNetworking.value=1\r\n    })\r\n}\r\n\r\n\r\nconst killSession=()=>{\r\n    syncbatchstartedStatusOnNetworking.value=2\r\n        API.get(\"/api/syncbatch/kill-session\").then(v=>{\r\n        syncbatchstartedStatusOnNetworking.value=1\r\n    })\r\n}\r\n\r\nconst saveGroupLoading=ref(false),groupsaved=ref(false),groupid=ref(\"\")\r\nconst saveGroup=()=>{\r\n    saveGroupLoading.value=true\r\nAPI.post(\"/api/group/new\", {\r\n                entry: syncbatchInfo.value.currentids.join(\",\"),\r\n                timestamp: (new Date()).getTime(),\r\n                title:syncbatchInfo.value.title,\r\n                desc:\"\"\r\n            }).then(i => {\r\n            saveGroupLoading.value = false\r\n            groupsaved.value = true\r\n            groupid.value = i.id\r\n        })\r\n}\r\n\r\n\r\nconst _JSONStringify=(o)=>JSON.stringify(o,undefined,4)\r\n\r\n\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"],"names":["hljs","json","syncbatchstartedStatusOnNetworking","ref","syncbatchInfo","SessionTitle","API","v","sync","StartSyncbatch","keepSyncing","onBeforeRouteLeave","editTitle","killSession","saveGroupLoading","groupsaved","groupid","saveGroup","i","_JSONStringify","o"],"mappings":"4yCAoCEA,EAAA,iBAAA,OAAAC,CAAA,EAIF,MAAAC,EAAAC,EAAA,CAAA,EAAAC,EAAAD,EAAA,CACA,QAAA,GACA,WAAA,CAAA,EACA,MAAA,EACA,CAAA,EAAAE,EAAAF,EAAA,EAAA,EAEAG,EAAA,IAAA,6BAAA,EAAA,KAAAC,GAAA,CACAH,EAAA,MAAAG,EAAA,KACAL,EAAA,MAAA,EAEAE,EAAA,MAAA,UACAC,EAAA,MAAAD,EAAA,MAAA,MACAI,EAAA,EAEA,CAAA,EACA,MAAAC,EAAA,IAAA,CACAP,EAAA,MAAA,EACAI,EAAA,KAAA,+BAAA,CAAA,MAAAD,EAAA,MAAA,KAAA,IAAA,KAAA,EAAA,QAAA,CAAA,CAAA,EAAA,KAAAE,GAAA,CACAH,EAAA,MAAAG,EAAA,KACAL,EAAA,MAAA,EACAM,EAAA,CACA,CAAA,CACA,EAEA,IAAAE,EAAA,GAEAC,EAAA,IAAA,CACAD,EAAA,EACA,CAAA,EAEA,MAAAF,EAAA,IAAA,CACAN,EAAA,MAAA,EACAI,EAAA,IAAA,6BAAA,EAAA,KAAAC,GAAA,CACAH,EAAA,MAAAG,EAAA,KACAL,EAAA,MAAA,EACAQ,GACA,WAAAF,EAAA,IAAA,CAEA,CAAA,CACA,EAEAI,EAAA,IAAA,CACAV,EAAA,MAAA,EACAI,EAAA,KAAA,4BAAA,CAAA,MAAAD,EAAA,KAAA,CAAA,EAAA,KAAAE,GAAA,CACAH,EAAA,MAAAG,EAAA,KACAL,EAAA,MAAA,CACA,CAAA,CACA,EAGAW,EAAA,IAAA,CACAX,EAAA,MAAA,EACAI,EAAA,IAAA,6BAAA,EAAA,KAAAC,GAAA,CACAL,EAAA,MAAA,CACA,CAAA,CACA,EAEAY,EAAAX,EAAA,EAAA,EAAAY,EAAAZ,EAAA,EAAA,EAAAa,EAAAb,EAAA,EAAA,EACAc,EAAA,IAAA,CACAH,EAAA,MAAA,GACAR,EAAA,KAAA,iBAAA,CACA,MAAAF,EAAA,MAAA,WAAA,KAAA,GAAA,EACA,UAAA,IAAA,KAAA,EAAA,QAAA,EACA,MAAAA,EAAA,MAAA,MACA,KAAA,EACA,CAAA,EAAA,KAAAc,GAAA,CACAJ,EAAA,MAAA,GACAC,EAAA,MAAA,GACAC,EAAA,MAAAE,EAAA,EACA,CAAA,CACA,EAGAC,EAAAC,GAAA,KAAA,UAAAA,EAAA,OAAA,CAAA"}