import{A as k}from"./APIHelper-4c0d0968.js";import{aZ as c,a8 as i,l as y,j as g,aE as u,t as s,b7 as n,s as o,k as _,m as v,F as N,ae as H,bd as C}from"./runtime-core.esm-bundler-c066f4bf.js";import{N as S}from"./Input-32bb51de.js";import{a as p}from"./Button-418af94d.js";import{N as h}from"./Card-e4be8a6b.js";import"./light-96080c0b.js";import"./format-length-c9d165c6.js";import"./Icon-e6ca0735.js";import"./Warning-ff31488d.js";import"./Close-d6ea1a86.js";import"./Scrollbar-25ba1ebe.js";import"./runtime-dom.esm-bundler-caa8590e.js";import"./use-memo-b9add725.js";import"./use-locale-55e0af58.js";import"./index-975a2d8f.js";import"./use-merged-state-89f8109f.js";import"./light-a188f855.js";import"./Suffix-fac0a942.js";import"./FadeInExpandTransition-ff940b4d.js";const I=["innerHTML"],V=["innerHTML"],$={key:0},j=["src"],O=["innerHTML"],R=v("div",null,null,-1),oe={__name:"index",setup(D){const w=c(""),d=c(1),a=c([]),m=c(""),b=c({}),x=c({}),T=t=>{if(t.key=="Enter"){let l=window.getSelection().toString();a.value.push(l)}},A=()=>{d.value=2,document.addEventListener("keypress",T)},E=async()=>{d.value=31,a.value,a.value=a.value.map(t=>({met:t,list:[],tdp:{}}));for(let t=0;t<a.value.length;t++)await k.get("/api/xkw-helper/qsearch/"+m.value+"/"+a.value[t].met.slice(0,40)).then(l=>{a.value[t].list=l.data.list,a.value[t].index=0,a.value[t].tdp=a.value[t].list[a.value[t].index],l.data.list.forEach((e,r)=>{r<6&&M(m.value,e.id)})})},f=c(0),L=async()=>{d.value=32,a.value,a.value=a.value.map(t=>({met:t,list:[],tdp:{}}));for(let t=0;t<a.value.length;t++)a.value[t].display=!1;a.value[0].display=!0},M=async(t,l)=>{await k.get("/api/qapi/is_collected/"+t+"/"+l).then(e=>{b.value[l]=JSON.stringify(e)})},U=async t=>{x.value[t]=!0,await k.get("/api/xkw-helper/get_pure_question/"+m.value+"/"+t).then(async l=>{const e=l.data,r={bankid:m.value,qid:t,q:e.body,a:"<answerparser>unsaved|u</answerparser>",extra:JSON.stringify({from:e.paperSources[0]?e.paperSources[0].name:"",knowledgepoint:e.knowledgeInfo.split("ï¼Œ"),info:[e.type.name,e.diff.name+"("+e.diff.value+")"]}),timestamp:new Date().getTime()};k.post("/api/add",r).then(F=>{x.value[t]=!1})})},B=()=>{k.post("/api/regen-attach/state-update/contentupd",a.value.map(t=>encodeURIComponent(t.met.replaceAll(`\r
`," ").replaceAll(/[ \t]/g," ").slice(0,100)))).then(t=>{location.href=k.host+"/api/regen-attach/router/begin"})};return(t,l)=>(i(),y(N,null,[d.value==1?(i(),g(n(h),{key:0},{default:u(()=>[s(n(S),{value:w.value,"onUpdate:value":l[0]||(l[0]=e=>w.value=e),type:"textarea"},null,8,["value"]),s(n(S),{value:m.value,"onUpdate:value":l[1]||(l[1]=e=>m.value=e)},null,8,["value"]),s(n(p),{onClick:A},{default:u(()=>[o("RUN")]),_:1})]),_:1})):_("",!0),d.value==2?(i(),g(n(h),{key:1},{default:u(()=>[v("div",{innerHTML:a.value.join("<br/>")},null,8,I),v("div",{innerHTML:w.value.replaceAll(`
`,"<br/>")},null,8,V),s(n(p),{onClick:E},{default:u(()=>[o("RUN")]),_:1}),s(n(p),{onClick:L},{default:u(()=>[o("RUN using ifr")]),_:1})]),_:1})):_("",!0),d.value==32?(i(),g(n(h),{key:2},{default:u(()=>[s(n(p),{onClick:B},{default:u(()=>[o("GOTO zujuan.xkw.com")]),_:1})]),_:1})):_("",!0),d.value==32?(i(),g(n(h),{key:3},{default:u(()=>[(i(!0),y(N,null,H(a.value,e=>(i(),y("div",{key:e.key},[e.display?(i(),y("div",$,[v("p",null,C(e.met),1),v("iframe",{src:"https://zujuan.xkw.com/quessearch/?keyword="+e.met},null,8,j),s(n(p),{onClick:l[2]||(l[2]=r=>{a.value[f.value].display=!1,f.value++,a.value[f.value].display=!0})},{default:u(()=>[o("< next")]),_:1}),s(n(p),{onClick:l[3]||(l[3]=r=>{a.value[f.value].display=!1,f.value--,a.value[f.value].display=!0})},{default:u(()=>[o("prev >")]),_:1})])):_("",!0)]))),128))]),_:1})):_("",!0),d.value==31?(i(),g(n(h),{key:4},{default:u(()=>[(i(!0),y(N,null,H(a.value,e=>(i(),y("div",{key:e.met},[v("p",null,C(e.met),1),v("div",{innerHTML:e.tdp.body},null,8,O),v("p",null,"QID:"+C(e.tdp.id)+" || "+C(b.value[e.tdp.id]),1),s(n(p),{onClick:r=>U(e.tdp.id),loading:x.value[e.tdp.id]},{default:u(()=>[o("SAVE")]),_:2},1032,["onClick","loading"]),s(n(p),{onClick:r=>e.tdp=e.list[--e.index]},{default:u(()=>[o("< CHANGE")]),_:2},1032,["onClick"]),s(n(p),{onClick:r=>e.tdp=e.list[++e.index]},{default:u(()=>[o("CHANGE >")]),_:2},1032,["onClick"])]))),128))]),_:1})):_("",!0),R],64))}};export{oe as default};
