{"version":3,"file":"preexport-ec07df94.js","sources":["../../src/views/grouping/preexport.vue"],"sourcesContent":["<template>\r\n    <n-button class=\"noprint\" @click=\"shown.q=!shown.q\">Q</n-button>\r\n    <n-button class=\"noprint\" @click=\"shown.a=!shown.a\">A</n-button>\r\n    <n-button class=\"noprint\" @click=\"shown.p=!shown.p\">P</n-button>\r\n    <n-button class=\"noprint\" @click=\"currentClicker=addExtBlank\">单击题面时增加空格</n-button>\r\n    <n-button class=\"noprint\" @click=\"fontreset\">字体转为Times</n-button>\r\n    <n-button class=\"noprint\" @click=\"printhelper_columns==2?(printhelper_columns=1):(printhelper_columns=2)\">改变列数\r\n    </n-button>\r\n    <n-button class=\"noprint\" @click=\"currentClicker=()=>{};optiontableInit()\">修正opttable</n-button>\r\n    <n-button class=\"noprint\" @click=\"Noptions_ret2=true\">Retheme 2</n-button>\r\n    <n-button class=\"noprint\" @click=\"titleformat++\">Title format</n-button>\r\n    <n-button class=\"noprint\" @click=\"infoformat++\">Info format</n-button>\r\n    <n-button class=\"noprint\" @click=\"op2change()\">进入不包含fixed content的修正页面</n-button>\r\n     <n-spin :show=\"loadingContentFlag\">\r\n              <template #description>\r\n        状态：{{loadedChunksCount==-1?\"正在获取Group数据\":\"已加载了\"+loadedChunksCount+\"条\"}}\r\n      </template>\r\n    <div :style=\"{width:'18.76cm','line-height':'normal'}\" id=\"oonom\">\r\n        <div class=\"noprint\">\r\n            <div class=\"labi-container\">\r\n                <div class=\"labi-block\" v-for=\"rr in [1,2,3,4,5,6,7]\" :key=\"rr\" :style=\"{height:1045+'px'}\">Page #\r\n                    {{rr}}</div>\r\n            </div>\r\n        </div>\r\n        <div id=\"corehtml\" :style=\"{width:'18.76cm',columns:printhelper_columns,'line-height':'normal'}\"  v-if=\"!loadingContentFlag\">\r\n\r\n            <p v-if=\"titleformat%titleformatCount==0\" style=\"font-size:6.5pt;font-family:Cambria , 仿宋;margin:0px\">\r\n                Generated by thost | Group UUID: {{$route.params.id}} | Title: {{grouptitle}}</p>\r\n            <div v-if=\"titleformat%titleformatCount==1\" style=\"text-align:center;font-family:Cambria , 仿宋;margin:0px\">\r\n                <p style=\"font-size:10pt;\">{{grouptitle}}</p>\r\n                <p style=\"font-size:6.5pt;\">Generated by thost | UUID: <span\r\n                        style=\"font-family:'courier new'\">{{$route.params.id}}</span></p>\r\n            </div>\r\n            <div v-if=\"titleformat%titleformatCount==2\" style=\"text-align:center;font-family:黑体;margin:0px\">\r\n                <p style=\"font-size:10pt;\">{{grouptitle}}</p>\r\n            </div>\r\n            <div v-for=\"oo,i in chunk2array(Tlist)\" :key=\"oo.id\" @click=\"currentClicker(oo.id)\"\r\n                :data_type=\"_JSONparse(oo.extra).info[0]\" class=\"___core_block\">\r\n\r\n                <p v-if=\"infoformat%infoformatCount==0\" style=\"font-size:6.5pt;margin:0px;font-family:Cambria , 仿宋;\">\r\n                    UUID:<span style=\"font-family:'courier new'\">{{oo.id}}</span> | qid:<span\r\n                        style=\"font-family:'courier new'\">{{oo.qid}}</span> <span v-if=\"shown.q\">| Info:\r\n                        {{_JSONparse(oo.extra).info}} | Origin: {{_JSONparse(oo.extra).from}}</span></p>\r\n                <div v-if=\"infoformat%infoformatCount==0\">\r\n                    <div v-if=\"shown.q\" v-html=\"normalizeq(oo.q,{ret2:Noptions_ret2})\"\r\n                        :style=\"{fontSize:'9.5pt',fontFamily:__Fontfamily}\"></div>\r\n                </div>\r\n                <div v-if=\"infoformat%infoformatCount==1\">\r\n                    <div v-if=\"shown.q\"\r\n                        v-html=\"'<strong>'+(i+1)+'.</strong> ('+_JSONparse(oo.extra).info[0]+','+_JSONparse(oo.extra).info[1]+') '+normalizeq(oo.q,{ret2:Noptions_ret2})\"\r\n                        :style=\"{fontSize:'9.5pt',fontFamily:__Fontfamily}\"></div>\r\n                </div>\r\n                <div v-if=\"infoformat%infoformatCount==2\">\r\n                    <div v-if=\"shown.q\"\r\n                        v-html=\"'<strong>'+(i+1)+'.</strong> '+normalizeq(oo.q,{ret2:Noptions_ret2})\"\r\n                        :style=\"{fontSize:'9.5pt',fontFamily:__Fontfamily}\"></div>\r\n                </div>\r\n                <div v-if=\"shown.q\" :style=\"{display:'block',height:(oo._extb_height||0)+'px'}\"></div>\r\n                <div v-if=\"shown.a\"><img\r\n                        :src='\"/oss-storage/\"+oo.a.replace(\"<answerparser>\",\"\").replace(\"</answerparser>\",\"\").split(\"|\")[0]+\".png\"' />\r\n                </div>\r\n                <div v-if=\"shown.p\"><img\r\n                        :src='\"/oss-storage/\"+oo.a.replace(\"<answerparser>\",\"\").replace(\"</answerparser>\",\"\").split(\"|\")[1]+\".png\"' />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    </n-spin>\r\n\r\n</template>\r\n\r\n<script setup>\r\n    import {\r\n        onMounted,\r\n        ref\r\n    } from \"vue\"\r\n    import {\r\n        useRoute,\r\n        useRouter\r\n    } from \"vue-router\"\r\n    const route = useRoute(),\r\n        router = useRouter()\r\n\r\n    import {\r\n        NButton,NSpin\r\n    } from \"naive-ui\"\r\n\r\n    import {\r\n        normalizeq\r\n    } from \"../../shared/normalize_q/toScreenDisplay\"\r\n    import {qtypes} from \"../../shared/define_basic_qtypes\"\r\n\r\n    import {\r\n        API\r\n    } from \"../../shared/APIHelper\"\r\n    const shown = ref({\r\n        q: true,\r\n        a: false,\r\n        p: false\r\n    })\r\n\r\n\r\n    const titleformat = ref(0),\r\n        infoformat = ref(0),\r\n        titleformatCount = 3,\r\n        infoformatCount = 3\r\n\r\n    const grouptitle = ref(\"\")\r\n\r\n    const loadingContentFlag=ref(true),loadedChunksCount=ref(-1)\r\n\r\n    const Tlist = ref({})\r\n    API.post(\"/api/group/get\", {\r\n        id: route.params.id\r\n    }).then(sss => {\r\nloadedChunksCount.value=0\r\n\r\n\r\n        sss.entry.split(\",\").forEach(v => {\r\n            Tlist.value[v] = qtypes\r\n        });\r\n\r\n\r\n        const Noptions_ret2 = ref(false)\r\n\r\n\r\n        grouptitle.value = sss.title\r\n\r\n        Promise.all(sss.entry.split(\",\").map(v => new Promise((res, rej) => {\r\n            API.get(\"/api/qapi/get/\" + v).then(i => {\r\n                Tlist.value[v] = i\r\n                loadedChunksCount.value++\r\n                res()\r\n            })\r\n        }))).then(() => {\r\n\r\nloadingContentFlag.value=false\r\n            console.log(\"hdd\",loadingContentFlag.value);\r\n        })\r\n        // fetch(\"/api/get\",{\"method\":\"POST\",\"body\":JSON.stringify({id:v}),\"headers\":{\"Content-Type\":\"application/json\"}}).then(o=>o.json()).then(i=>{\r\n        //     Tlist.value[v]=i\r\n        // })\r\n        // }))).then(()=>{\r\n\r\n        // })\r\n\r\n\r\n\r\n    })\r\n\r\n\r\n\r\n\r\n    //adddddd\r\n\r\n\r\n    const _JSONparse = (v) => {\r\n            return JSON.parse(v)\r\n        }\r\n\r\n        ,\r\n        chunk2array = mm => Object.entries(mm).map(o => o[1])\r\n\r\n\r\n    const currentClicker = ref((v) => {})\r\n\r\n    const addExtBlank = (id) => {\r\n        Tlist.value[id]._extb_height = (Tlist.value[id]._extb_height || 0) + 50\r\n        console.log(Tlist.value[id]._extb_height);\r\n    }\r\n\r\n    const printhelper_columns = ref(1)\r\n\r\n\r\n    const op2change = () => {\r\n        localStorage.setItem(\"___thost___html_export\", document.getElementById(\"corehtml\").outerHTML)\r\n        router.push(\"/grouping/preexport-2/\" + route.params.id)\r\n    }\r\n\r\n    const __Fontfamily = ref(\"Cambria , 宋体\")\r\n    const fontreset = () => {\r\n        __Fontfamily.value = \"Times New Roman , 宋体!important\"\r\n    }\r\n    const optiontableInit = () => {\r\n        document.querySelectorAll(\"table[name=optionsTable]\").forEach(v => {\r\n            if (v.querySelectorAll(\"td\").length == 4) {\r\n                console.log(\"oo\", v);\r\n                let opts = [],\r\n                    lns = 1\r\n                v.querySelectorAll(\"td\").forEach(oo => {\r\n                    opts.push(oo.outerHTML)\r\n                })\r\n                v.addEventListener(\"click\", () => {\r\n                    console.log(\"click\");\r\n                    const {\r\n                        ctn,\r\n                        next_lns\r\n                    } = toTable(opts, lns)\r\n                    v.innerHTML = ctn\r\n                    lns = next_lns\r\n                })\r\n            }\r\n\r\n        })\r\n\r\n        function toTable(opts, lns) {\r\n            if (lns == 1) {\r\n                return {\r\n                    ctn: \"<tbody><tr>\" + opts.join(\"\") + \"</tr></tbody>\",\r\n                    next_lns: 2\r\n                }\r\n            }\r\n            if (lns == 2) {\r\n                return {\r\n                    ctn: `<tbody><tr>${opts[0]}${opts[1]}</tr><tr>${opts[2]}${opts[3]}</tr></tbody>`,\r\n                    next_lns: 4\r\n                }\r\n            }\r\n            if (lns == 4) {\r\n                return {\r\n                    ctn: \"<tbody><tr>\" + opts.join(\"</tr><tr>\") + \"</tr></tbody>\",\r\n                    next_lns: 1\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    const HandleEnFormat = () => {\r\n\r\n    }\r\n\r\n\r\n\r\n    const _LOG = console.log\r\n</script>\r\n\r\n<style>\r\n    @media print {\r\n        .noprint {\r\n            display: none;\r\n        }\r\n\r\n    }\r\n\r\n    .labi-container {\r\n        display: block;\r\n        height: fit-content;\r\n        width: 100%;\r\n        position: absolute;\r\n        z-index: -1;\r\n    }\r\n\r\n    .labi-block {\r\n        display: block;\r\n        width: 100%;\r\n        border-bottom-color: black;\r\n        border-bottom-width: 2px;\r\n        position: relative;\r\n        border-bottom-style: dotted;\r\n        text-align: right;\r\n    }\r\n\r\n    img {\r\n        max-width: 350px;\r\n    }\r\n\r\n    td {\r\n        padding: 0\r\n    }\r\n</style>"],"names":["route","useRoute","router","useRouter","shown","ref","titleformat","infoformat","titleformatCount","infoformatCount","grouptitle","loadingContentFlag","loadedChunksCount","Tlist","API","sss","v","qtypes","res","rej","i","_JSONparse","chunk2array","mm","o","currentClicker","addExtBlank","id","printhelper_columns","op2change","__Fontfamily","fontreset","optiontableInit","opts","lns","oo","ctn","next_lns","toTable"],"mappings":"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"}