{"version":3,"file":"painttools-0071b983.js","sources":["../../src/views/zujuanink-v3/utils/painttools.js"],"sourcesContent":["\r\n// import \"./canvas2svg\"\r\nclass PaintTools{\r\n    constructor(dom){\r\n        this.dom=dom\r\n        this.paintlines=[]\r\n        this.painting=false\r\n        this.context = dom.getContext(\"2d\");\r\n    }\r\n\r\n    onmousedown(e){\r\n        console.log(window.PaintCONFIG.color);\r\n        this.paintlines.push(new RoadwayArea({color:window.PaintCONFIG.color||\"black\"}))\r\n        this.painting=true\r\n        this.paintlines[this.paintlines.length-1].touchDown(e.layerX,e.layerY)\r\n        this.paintlines[this.paintlines.length-1].touchMove(e.layerX+1,e.layerY+1)\r\n        this.refreshCanvas()\r\n        // console.log(this.paintlines[this.paintlines.length-1]);\r\n    }\r\n    onmouseup(e){\r\n        this.painting=false\r\n        this.paintlines[this.paintlines.length-1].touchUp(e.layerX,e.layerY)\r\n        // console.log(this.paintlines[this.paintlines.length-1]);\r\n    }\r\n\r\n    onpointermove(e){\r\n        if(this.painting){\r\n            // const coalescedEvents = e.getCoalescedEvents();\r\n            // for (let coalescedEvent of coalescedEvents) {\r\n            //     // give it an offset so we can see the difference and color it red\r\n            //     this.paintlines[this.paintlines.length-1].touchMove(coalescedEvent.layerX,coalescedEvent.layerY)\r\n            //     // drawCircle(coalescedEvent.clientX + 20, coalescedEvent.clientY + 20, \"red\");\r\n            //   }\r\n            this.paintlines[this.paintlines.length-1].touchMove(e.layerX,e.layerY)\r\n            this.refreshCanvas()\r\n            // console.log(this.paintlines[this.paintlines.length-1]);\r\n        }\r\n\r\n    }\r\n    refreshCanvas(e){\r\n\r\n        this.paintlines.forEach(v=>{v.drawSelf(this.context)})\r\n    }\r\n    clear(){\r\n        this.paintlines=[]\r\n        this.refreshCanvas()\r\n    }\r\n\r\n export(){\r\n    // var canvas = document.getElementById(\"canvas\");\r\n    var dataURL = this.dom.toDataURL();\r\n    console.log(dataURL);\r\n    }\r\n}\r\n\r\n\r\nclass Paint {\r\n    constructor(cfg) {\r\n        this.color = cfg.color || \"black\";\r\n        this.lineWidth = 2 ;\r\n        this.operation = \"source-over\";\r\n        this.alpha = 1;\r\n        this.mode = 0;\r\n        this.equals = function (paint) {\r\n            return this.color == paint.color && this.operation == paint.operation\r\n                && Math.abs(this.lineWidth - paint.lineWidth) < 0.0000001 && this.alpha == paint.alpha;\r\n        };\r\n        this.config = function (p) {\r\n            this.alpha = p.alpha || 1;\r\n            this.mode = p.mode || 0;\r\n            this.color = p.color || \"#000000\";\r\n            if (this.color.indexOf(\"#\") === -1) {\r\n                this.color = \"#\" + this.color;\r\n            }\r\n            if (p.operation) {\r\n                this.operation = p.operation;\r\n            } else {\r\n                if (this.mode == 1) {\r\n                    this.operation = \"destination-out\";\r\n                } else {\r\n                    this.operation = \"source-over\";\r\n                }\r\n            }\r\n            this.lineWidth = p.lineWidth || 1;\r\n        };\r\n    }\r\n}\r\n\r\nclass RoadwayArea {\r\n    constructor(p) {\r\n        this.path = new Path2D();\r\n        this.paint = {\r\n            color : p.color || \"black\",\r\nlineWidth : 1 ,\r\noperation : \"source-over\",\r\nalpha : 1,\r\nmode : 0\r\n        }\r\n        // this.paint.config(p);\r\n        this.step = -1;\r\n        var lineArray = [];\r\n        var line = null, px, py;\r\n\r\n        this.isEffective = function () {\r\n            return lineArray.length > 0 && this.step >= 0;\r\n        };\r\n        this.getCacheData = function () {\r\n            if (lineArray.length <= 0 || !this.isEffective()) {\r\n                return null;\r\n            }\r\n            var jsonArray = [];\r\n            for (var index in lineArray) {\r\n                if (index > this.step) {\r\n                    break;\r\n                }\r\n                var line = lineArray[index];\r\n                var pathJSONArray = null;\r\n                for (var i in line) {\r\n                    if (pathJSONArray == null) {\r\n                        pathJSONArray = [];\r\n                    }\r\n                    pathJSONArray.push(line[i].x + \",\" + line[i].y);\r\n                }\r\n                if (pathJSONArray != null) {\r\n                    jsonArray.push(pathJSONArray);\r\n                }\r\n            }\r\n            if (jsonArray.length > 0) {\r\n                return {\r\n                    points: jsonArray,\r\n                    color: this.paint.color.replace(\"#\", \"\"),\r\n                    line_width: this.paint.lineWidth,\r\n                    alpha: this.paint.alpha,\r\n                    mode: this.paint.mode\r\n                };\r\n            }\r\n            return null;\r\n        };\r\n        this.setCacheData = function (jsonObject) {\r\n            try {\r\n                this.paint.config(jsonObject);\r\n                var pointJSONArray = jsonObject.points;\r\n                for (var index in pointJSONArray) {\r\n                    var pathJSONArray = pointJSONArray[index];\r\n                    for (var i in pathJSONArray) {\r\n                        var point = pathJSONArray[i];\r\n                        var di = point.split(\",\");\r\n                        var x = parseFloat(di[0]);\r\n                        var y = parseFloat(di[1]);\r\n                        if (i == 0) {\r\n                            this.touchDown(x, y);\r\n                        } else {\r\n                            this.touchMove(x, y);\r\n                        }\r\n                    }\r\n                    this.touchUp();\r\n                }\r\n            } catch (e) {const density=3\r\n            }\r\n        };\r\n\r\n        this.touchDown = function (x, y) {\r\n            const density=3\r\n            px = x;\r\n            py = y;\r\n            this.path.moveTo(x * density, y * density);\r\n            line = [];\r\n            line.push({ x: x, y: y });\r\n            return true;\r\n        };\r\n        this.touchMove = function (x, y) {\r\n            const density=3\r\n            if (line != null && (Math.abs(x - px) >= 1 || Math.abs(y - py) >= 1)) {\r\n                // this.path.lineTo(px * density, py * density);\r\n                this.path.quadraticCurveTo(px * density, py * density, (x + px) / 2 * density, (y + py) / 2 * density);\r\n                px = x;\r\n                py = y;\r\n                // line.push({ x: x, y: y });\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n        this.touchUp = function () {\r\n            const density=3\r\n            if (line && line.length > 0) {\r\n                if (this.step < lineArray.length - 1) {\r\n                    lineArray.splice(this.step + 1);\r\n                }\r\n                lineArray.push(line);\r\n                this.step = lineArray.length - 1;\r\n                line = null;\r\n                return true;\r\n            }\r\n            line = null;\r\n            return false;\r\n        };\r\n        this.mementoStep = function (value) {\r\n            var step = this.step + value;\r\n            if (step >= -1 && step < lineArray.length) {\r\n                this.path = new Path2D();\r\n                this.step = step;\r\n                for (var i = 0; i <= step; i++) {\r\n                    var px = 0;\r\n                    var py = 0;\r\n                    var line = lineArray[i];\r\n                    for (var index in line) {\r\n                        var p = line[index];\r\n                        if (index == 0) {\r\n                            px = p.x;\r\n                            py = p.y;\r\n                            this.path.moveTo(p.x * density, p.y * density);\r\n                        } else {\r\n                            if (Math.abs(p.x - px) >= 4 || Math.abs(p.y - py) >= 4) {\r\n                                this.path.quadraticCurveTo(px * density, py * density, (p.x + px) / 2 * density, (p.y + py) / 2 * density);\r\n                                px = p.x;\r\n                                py = p.y;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n        this.drawSelf = function (context) {\r\n            const density=3\r\n            context.globalCompositeOperation = this.paint.operation;\r\n            context.strokeStyle = this.paint.color;\r\n            context.globalAlpha = this.paint.alpha;\r\n            context.lineWidth = this.paint.lineWidth * density;\r\n            context.lineCap = \"round\";\r\n            context.stroke(this.path);\r\n        };\r\n    }\r\n}\r\n\r\nexport{PaintTools}"],"names":["PaintTools","dom","e","RoadwayArea","v","dataURL","p","lineArray","line","px","py","jsonArray","index","pathJSONArray","i","jsonObject","pointJSONArray","point","di","x","y","value","step","context"],"mappings":"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"}